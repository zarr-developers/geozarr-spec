
=== Common Data Model Encodings

==== Hierarchical Structure

A GeoZarr hierarchy follows the CDM model of a tree of **groups**, **variables** (arrays), **dimensions**, and **attributes**.
Each Zarr store contains a single root group and an arbitrary number of child groups and arrays, organised recursively.

[cols="1,2,2"]
|===
|CDM Element |Zarr v2 Encoding |Zarr v3 Encoding

|Group | Directory with `.zgroup` and `.zattrs` | Directory containing `zarr.json` with `"node_type": "group"`
|Variable (Array) | Directory with `.zarray` and `.zattrs` | Directory containing `zarr.json` with `"node_type": "array"`
|Attributes | `.zattrs` file (JSON object) | `attributes` field in `zarr.json`
|===

Zarr v3 nodes must declare `"zarr_format": 3` and include `"node_type"` set to either `"group"` or `"array"`.
All user-defined metadata, including GeoZarr attributes, shall be placed within the `attributes` field.

==== Dimensions

Dimensions define the index axes for variables.

[cols="1,2,2"]
|===
|Aspect |Zarr v2 |Zarr v3

|Declaration | `_ARRAY_DIMENSIONS` attribute in `.zattrs` | `dimension_names` field in `zarr.json`
|Scope | Implicit, per array | Explicit, per array; names are globally unique within a group hierarchy
|===

Example (Zarr v3 array with two dimensions):
[source,json]
----
{
  "zarr_format": 3,
  "node_type": "array",
  "shape": [180, 360],
  "dimension_names": ["lat", "lon"],
  ...
}
----

**Shared Dimensions:**

Zarr does not define dimension entities as standalone objects.
To preserve CDM semantics, GeoZarr requires that dimension names be **unique within each group hierarchy** and reused consistently across variables that share the same axis.

As in **netCDF-4**, where groups can define their own local dimensions, GeoZarr allows dimensions to be scoped within groups.
When a dimension defined in one group is shared by variables located in descendant groups, implementations may indicate this relationship by prefixing the dimension name with a slash (e.g., `"/time"`).
In this context, the leading slash signifies that the dimension is defined in an **ancestor group**—not necessarily the root of the hierarchy—and should be interpreted as a shared axis accessible to all subordinate groups.


==== Coordinate Variables

Coordinate variables define the spatial, temporal, or other contextual axes for data variables.
They are stored as one-dimensional arrays associated with their corresponding dimensions.

[cols="1,2,2"]
|===
|Aspect |Zarr v2 |Zarr v3

|Storage | Zarr array with `.zarray`, `.zattrs` | Zarr array with `zarr.json`
|Dimension Binding | `_ARRAY_DIMENSIONS` in `.zattrs` | `dimension_names` in `zarr.json`
|Metadata | CF-style attributes (e.g., `standard_name`, `units`, `axis`) | Same under `attributes`
|===

Example (Zarr v3 coordinate array):
[source,json]
----
{
  "zarr_format": 3,
  "node_type": "array",
  "shape": [180],
  "dimension_names": ["lat"],
  "data_type": "float32",
  "attributes": {
    "standard_name": "latitude",
    "units": "degrees_north",
    "axis": "Y"
  }
}
----

Coordinate variables may also reference *grid mapping* variables for coordinate reference systems, as defined in the CF conventions.

==== Data Variables

Data variables represent primary measurements or derived quantities.
They are encoded as multidimensional arrays linked to one or more dimensions and accompanied by descriptive metadata.

[cols="1,2,2"]
|===
|Aspect |Zarr v2 |Zarr v3

|Storage | Directory containing `.zarray` and `.zattrs` | Directory containing `zarr.json` with `"node_type": "array"`
|Dimension Binding | `_ARRAY_DIMENSIONS` attribute | `dimension_names` field
|Metadata | Attributes such as `standard_name`, `units`, `long_name`, `_FillValue`, `scale_factor`, `add_offset` | Same, with typed attributes permitted in v3
|===

Example:
[source,json]
----
{
  "zarr_format": 3,
  "node_type": "array",
  "shape": [12, 180, 360],
  "dimension_names": ["time", "lat", "lon"],
  "attributes": {
    "standard_name": "air_temperature",
    "units": "K",
    "long_name": "Surface air temperature",
    "_FillValue": -9999.0
  }
}
----

==== Global and Group Metadata

Metadata applying to the entire hierarchy or subgroup is stored at the group level.

[cols="1,2,2"]
|===
|Aspect |Zarr v2 |Zarr v3

|Location | `.zattrs` in root group | `attributes` field in root `zarr.json`
|Identification | `.zgroup` file | `"node_type": "group"`
|Conventions | `Conventions` attribute (e.g., `CF-1.10`) | Same under `attributes`
|===

Example:
[source,json]
----
{
  "zarr_format": 3,
  "node_type": "group",
  "attributes": {
    "title": "Example Dataset",
    "summary": "Multidimensional Earth Observation data",
    "institution": "Example Space Agency",
    "Conventions": "CF-1.10"
  }
}
----

==== Variable and Attribute Metadata

All metadata attributes for groups, coordinate variables, and data variables should follow established community naming and typing conventions.
GeoZarr encourages CF-compliant naming where applicable but does not require it.

Attributes shall:
- use UTF-8–encoded names;
- have JSON-compatible values (string, number, boolean, or array);
- remain consistent across group hierarchies.

Typical attributes include:

* CF: `standard_name`, `units`, `axis`, `grid_mapping`
* Generic: `_FillValue`, `scale_factor`, `add_offset`, `long_name`, `missing_value`
* GDAL-compatible: `spatial_ref`, `GeoTransform`, `AREA_OR_POINT`

Structured metadata values, such as JSON or XML content, may be included directly as objects rather than as serialised text. Implementations are encouraged to **store such metadata in deserialised form** (as native JSON objects) whenever possible, ensuring that attributes remain machine-readable and conform to JSON type rules.

If serialised representations (e.g., XML strings or JSON text blocks) are used, they shall be valid UTF-8 strings and clearly identified by attribute naming or context.


==== CDM Encoding Notes and Special Cases

* **Shared Dimensions** –
To emulate the CDM concept of shared dimensions, GeoZarr requires that identical dimension names across arrays refer to the same logical axis.
Libraries implementing GeoZarr should preserve this relationship explicitly in their in-memory representations.

* **Unlimited Dimensions** –
Zarr’s chunked structure inherently supports extensible dimensions.
A dimension can be declared unlimited by allowing its corresponding array dimension to grow dynamically (e.g., time).
The use of `"resizeable": true` (Zarr v3) or dynamic chunk append operations is recommended.

* **Nested Groups and Subgroups** –
Zarr v3 groups may nest recursively.
Each subgroup represents a CDM group and may hold its own variables and attributes.
This structure supports logical organisation such as multiple collections, products, or resolution levels.

==== Metadata Integration for CF, GDAL, and GeoTIFF

While the GeoZarr Data Model provides the structure for metadata storage, **GeoZarr does not redefine how CF, GDAL, or GeoTIFF metadata are mapped into this structure**.
These mappings are well established in community libraries (e.g., *xarray*, *netCDF-Java*, *GDAL*).

GeoZarr encoding rules therefore only specify **when a specific Zarr encoding requirement applies**, such as:

* use of `attributes` fields in `zarr.json` for CF or GDAL metadata;
* preservation of key metadata names (`grid_mapping`, `spatial_ref`, `GeoTransform`);
* ensuring metadata values remain valid JSON types.

Implementations may rely on existing libraries to populate or interpret such metadata consistently.

